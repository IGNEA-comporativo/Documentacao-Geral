<!DOCTYPE html>
<html lang="pt-br" data-accent-color="violet" data-content_root="../">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0"><title>🔵 Banco de Dados - GeradorRelatorios documentation</title><link rel="index" title="Index" href="../genindex.html" /><link rel="search" title="Search" href="../search.html" /><link rel="next" title="🔵 Guia da documentação" href="documentation.html" /><link rel="prev" title="🔵 Deploy" href="deploy.html" /><script>
    function setColorMode(t){let e=document.documentElement;e.setAttribute("data-color-mode",t);let a=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches,s=t;"auto"===t&&(s=a?"dark":"light"),"light"===s?(e.classList.remove("dark"),e.classList.add("light")):(e.classList.remove("light"),e.classList.add("dark"))}
    setColorMode(localStorage._theme||"auto");
  </script><link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=397bb51e" />
    <link rel="stylesheet" type="text/css" href="../_static/shibuya.css?v=d48c410d" />
    <link media="print" rel="stylesheet" type="text/css" href="../_static/print.css?v=20ff2c19" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
:root {
  --sy-f-text: "Inter", var(--sy-f-sys), var(--sy-f-cjk), sans-serif;
  --sy-f-heading: "Inter", var(--sy-f-sys), var(--sy-f-cjk), sans-serif;
}
</style>
    <meta property="og:type" content="website"/><meta property="og:title" content="🔵 Banco de Dados"/>
<meta name="twitter:card" content="summary"/>
  </head>
<body><div class="sy-head">
  <div class="sy-head-blur"></div>
  <div class="sy-head-inner sy-container mx-auto">
    <a class="sy-head-brand" href="../index.html">
      
      
      <strong>GeradorRelatorios</strong>
    </a>
    <div class="sy-head-nav" id="head-nav">
      <nav class="sy-head-links"></nav>
      <div class="sy-head-extra flex items-center print:hidden"><form class="searchbox flex items-center" action="../search.html" method="get">
  <input type="text" name="q" placeholder="Search" />
  <kbd>/</kbd>
</form><div class="sy-head-socials"></div></div>
    </div>
    <div class="sy-head-actions flex items-center shrink-0 print:hidden"><button class="js-theme theme-switch flex items-center"
data-aria-auto="Switch to light color mode"
data-aria-light="Switch to dark color mode"
data-aria-dark="Switch to auto color mode">
<i class="i-lucide theme-icon"></i>
</button><button class="md:hidden flex items-center js-menu" aria-label="Menu" type="button" aria-controls="head-nav" aria-expanded="false">
        <div class="hamburger">
          <span class="hamburger_1"></span>
          <span class="hamburger_2 -translate-x-2"></span>
          <span class="hamburger_3 -translate-x-1"></span>
        </div>
      </button>
    </div>
  </div>
</div>
<div class="sy-page sy-container flex mx-auto">
  <aside id="lside" class="sy-lside md:w-72 md:shrink-0 print:hidden">
    <div class="sy-lside-inner md:sticky">
      <div class="sy-scrollbar p-6">
        <div class="globaltoc" data-expand-depth="0"><p class="caption" role="heading" aria-level="3"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../frontend/frontend.html">🔵 Frontend</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../frontend/components/login.html">🔷 Login</a></li>
<li class="toctree-l2"><a class="reference internal" href="../frontend/components/navbar.html">🔷 NavBar</a></li>
<li class="toctree-l2"><a class="reference internal" href="../frontend/components/notificationComp.html">🔷 NotificationComp</a></li>
<li class="toctree-l2"><a class="reference internal" href="../frontend/components/criadorCapitulos.html">🔷 Criador de Capítulos</a></li>
<li class="toctree-l2"><a class="reference internal" href="../frontend/components/modelosRelatorios.html">🔷 Modelos de Relatórios</a></li>
<li class="toctree-l2"><a class="reference internal" href="../frontend/components/modelosRelatorios.html#twosidelist-interno-a-modelosrelatorios">🔷 TwoSideList (interno a ModelosRelatorios)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../frontend/components/areaDeTrabalho.html">🔷 Área de Trabalho</a></li>
<li class="toctree-l2"><a class="reference internal" href="../frontend/components/areaDeTrabalho.html#inputfields-interno-a-areadetrabalho">🔷 InputFields (interno a AreaDeTrabalho)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../frontend/components/areaDeTrabalho.html#promptfields-interno-a-areadetrabalho">🔷 PromptFields (interno a AreaDeTrabalho)</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../backend/backend.html">🔵 Backend</a></li>
<li class="toctree-l1"><a class="reference internal" href="../backend/geracao_documentos.html">🔵 Geração de Documentos</a></li>
<li class="toctree-l1"><a class="reference internal" href="deploy.html">🔵 Deploy</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">🔵 Banco de Dados</a></li>
<li class="toctree-l1"><a class="reference internal" href="documentation.html">🔵 Guia da documentação</a></li>
</ul>

        </div>
      </div>
    </div>
  </aside>
  <div class="lside-overlay js-menu" role="button" aria-label="Close left sidebar" aria-controls="lside" aria-expanded="false"></div>
  <aside id="rside" class="sy-rside pb-3 w-64 shrink-0 order-last">
    <button class="rside-close js-menu xl:hidden" aria-label="Close Table of Contents" type="button" aria-controls="rside" aria-expanded="false">
      <i class="i-lucide close"></i>
    </button>
    <div class="sy-scrollbar sy-rside-inner px-6 xl:top-16 xl:sticky xl:pl-0 pt-6 pb-4"><div class="localtoc"><h3>On this page</h3><ul>
<li><a class="reference internal" href="#stack-e-dependencias">&#128311; Stack e Depend&#234;ncias</a></li>
<li><a class="reference internal" href="#visao-geral">&#128311; Vis&#227;o Geral</a></li>
<li><a class="reference internal" href="#referencia-das-tabelas-modelos">&#128310; Refer&#234;ncia das Tabelas / Modelos</a><ul>
<li><a class="reference internal" href="#chapters-app-models-chapters-chapter">&#128312;<code class="docutils literal notranslate"><span class="pre">chapters</span></code> &#8212; <code class="docutils literal notranslate">models.chapters.Chapter</span></code></a></li>
<li><a class="reference internal" href="#reports-app-models-reports-report">&#128312; <code class="docutils literal notranslate"><span class="pre">reports</span></code> &#8212; <code class="docutils literal notranslate">models.reports.Report</span></code></a></li>
<li><a class="reference internal" href="#relations-app-models-relations-relation">&#128312;<code class="docutils literal notranslate"><span class="pre">relations</span></code> &#8212; <code class="docutils literal notranslate">models.relations.Relation</span></code></a></li>
<li><a class="reference internal" href="#built-reports-app-models-built-reports-builtreports">&#128312; <code class="docutils literal notranslate"><span class="pre">built_reports</span></code> &#8212; <code class="docutils literal notranslate">models.built_reports.BuiltReports</span></code></a></li>
<li><a class="reference internal" href="#object-storage-app-models-object-storage-objectstorage">&#128312; <code class="docutils literal notranslate"><span class="pre">object_storage</span></code> &#8212; <code class="docutils literal notranslate">models.object_storage.ObjectStorage</span></code></a></li>
<li><a class="reference internal" href="#storage-relation-app-models-storage-relation-storagerelation">&#128312; <code class="docutils literal notranslate"><span class="pre">storage_relation</span></code> &#8212; <code class="docutils literal notranslate">models.storage_relation.StorageRelation</span></code></a></li>
</ul>
</li>
</ul>
</div><div id="ethical-ad-placement" data-ea-publisher="readthedocs"></div></div>
  </aside>
  <div class="rside-overlay js-menu" role="button" aria-label="Close Table of Contents" aria-controls="rside" aria-expanded="false"></div>
  <main class="sy-main w-full max-sm:max-w-full print:pt-6">
<div class="sy-breadcrumbs" role="navigation">
  <div class="sy-breadcrumbs-inner flex items-center">
    <div class="md:hidden mr-3">
      <button class="js-menu" aria-label="Menu" type="button" aria-controls="lside" aria-expanded="false">
        <i class="i-lucide menu"></i>
      </button>
    </div>
    <ol class="flex-1" itemscope itemtype="https://schema.org/BreadcrumbList"><li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
        <a itemprop="item" href="../index.html"><span itemprop="name">GeradorRelatorios</span></a>
        <span>/</span>
        <meta itemprop="position" content="1" />
      </li><li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
        <strong itemprop="name">🔵 Banco de Dados</strong>
        <meta itemprop="position" content="2" />
      </li></ol>
    <div class="xl:hidden ml-1">
      <button class="js-menu" aria-label="Show table of contents" type="button" aria-controls="rside"
        aria-expanded="false">
        <i class="i-lucide outdent"></i>
      </button>
    </div>
  </div>
</div><div class="flex flex-col break-words justify-between">
      <div class="min-w-0 max-w-6xl px-6 pb-6 pt-8 xl:px-12">
        <article class="yue" role="main">
          <section id="banco-de-dados">
<h1>🔵 Banco de Dados<a class="headerlink" href="#banco-de-dados" title="Link to this heading">¶</a></h1>
<p>Documentação de referência do subsistema de persistência do <strong>Gerador de Relatórios</strong>.<br />
Estrutura baseada em <strong>SQLAlchemy (Declarative)</strong> e <strong>PostgreSQL</strong>.</p>
<p>O banco de dados é desenvolvido em PostgreSQL e hospedado na AWS Lightsail. As informações sobre o banco estão a seguir:</p>
<div class="table-wrapper colwidths-auto docutils container">
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Campo</p></th>
<th class="head"><p>Valor</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">DB_USER</span></code></p></td>
<td><p>dbmasteruser</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">DB_PASS</span></code></p></td>
<td><p>*0G8^qqb`kOuW~b1TS#</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">DB_HOST</span></code></p></td>
<td><p>ls-6c91ee6007055f9ff152e646713483c83cbaa2d7.cez4ccce2p5m.us-east-1.rds.amazonaws.com</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">DB_PORT</span></code></p></td>
<td><p>5432</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">DB_NAME</span></code></p></td>
<td><p>dbgerador_relatorios</p></td>
</tr>
</tbody>
</table>
</div>
<p>Todo a estruturação das tabelas, desde da criação, implementação até a usabilidade é realizado via a biblioteca <code class="docutils literal notranslate"><span class="pre">SQLAlchemy</span></code>. A definição de cada tabela é feita em um arquivo exclusivo, sob o diretório <code class="docutils literal notranslate"><span class="pre">src/backend/app/models/</span></code>.</p>
<section id="stack-e-dependencias">
<h2>🔷 Stack e Dependências<a class="headerlink" href="#stack-e-dependencias" title="Link to this heading">¶</a></h2>
<p>Tecnologias Utilizadas</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">PostgreSQL</span></code>: Tecnologia SQL usada para o banco de dados.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">JSONB</span></code>: Tipo de coluna específico ao PostgreSQL, cujo formato é utilizado para guardar os relatórios gerados (não é uma extensão).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">SQLAlchemy</span></code>: Framework Python para utilização, criação e conexeção com o banco de dados PostgreSQL</p></li>
</ul>
</section>
<section id="visao-geral">
<h2>🔷 Visão Geral<a class="headerlink" href="#visao-geral" title="Link to this heading">¶</a></h2>
<p>Temos 6 tabelas no banco de dados e lógica entre elas é bem direta.</p>
<p>Um <strong>modelo de relatório</strong> é composto por uma combinação específica de <strong>capítulos</strong> e diversos modelos podem reutilizar o mesmo capítulo (pense em introdução ou conclusão). Por esse motivo, para não criar elementos repetidos no banco de dados temos a tabela <code class="docutils literal notranslate"><span class="pre">chapters</span></code>, que armazena os capítulos, e a tabela <code class="docutils literal notranslate"><span class="pre">reports</span></code> que armazena os modelos criados. Para conectá-los utiliza-se a tabela <code class="docutils literal notranslate"><span class="pre">relations</span></code> que estipula uma relação muitos para muitos (many to many) entre qual capítulo está em qual modelo.</p>
<p>Agora com relação a criação dos relatórios também temos 3 partes. Primeiro, relatórios criados são armazenados na tabela <code class="docutils literal notranslate"><span class="pre">built_reports</span></code>. Nela, guardamos informações do relatório produzido, como título, descrição, se está completo e data. Além disso, o próprio relatório é armazenado nessa tabela, sob a coluna <code class="docutils literal notranslate"><span class="pre">report_obj</span></code> no formato <code class="docutils literal notranslate"><span class="pre">JSONB</span></code>. Ou seja, relatórios são armazenados como JSON, na seguinte estrutura:</p>
<div class="highlight-JSON notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="p">{</span>
</span><span data-line="2"><span class="w">  </span><span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;unnamed&quot;</span><span class="p">,</span>
</span><span data-line="3"><span class="w">  </span><span class="nt">&quot;chapters&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span data-line="4"><span class="w">    </span><span class="p">{</span>
</span><span data-line="5"><span class="w">      </span><span class="nt">&quot;text&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span data-line="6"><span class="w">      </span><span class="nt">&quot;links&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[],</span>
</span><span data-line="7"><span class="w">      </span><span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span data-line="8"><span class="w">      </span><span class="nt">&quot;filled&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
</span><span data-line="9"><span class="w">      </span><span class="nt">&quot;prompt&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span data-line="10"><span class="w">      </span><span class="nt">&quot;position&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;1&quot;</span><span class="p">,</span>
</span><span data-line="11"><span class="w">      </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&quot;</span>
</span><span data-line="12"><span class="w">    </span><span class="p">},</span>
</span><span data-line="13"><span class="w">    </span><span class="p">{</span>
</span><span data-line="14"><span class="w">      </span><span class="nt">&quot;text&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span data-line="15"><span class="w">      </span><span class="nt">&quot;links&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[],</span>
</span><span data-line="16"><span class="w">      </span><span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span data-line="17"><span class="w">      </span><span class="nt">&quot;filled&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
</span><span data-line="18"><span class="w">      </span><span class="nt">&quot;prompt&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span data-line="19"><span class="w">      </span><span class="nt">&quot;position&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2&quot;</span><span class="p">,</span>
</span><span data-line="20"><span class="w">      </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&quot;</span>
</span><span data-line="21"><span class="w">    </span><span class="p">}</span>
</span><span data-line="22"><span class="w">  </span><span class="p">],</span>
</span><span data-line="23"><span class="w">  </span><span class="nt">&quot;completed&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
</span><span data-line="24"><span class="w">  </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&quot;</span>
</span><span data-line="25"><span class="p">}</span>
</span></pre></div>
</div>
<p>Além disso, armazenamos também os arquivos que foram utilizados para gerar essa relatório. Para isso, inicialmente foi criado uma tabela que simula um <code class="docutils literal notranslate"><span class="pre">object_storage</span></code>, onde os arquivos são armazenados como binários, em conjunto com outras informações importantes sobre o arquivo. Ademais, para não manter arquivos repetidos no banco de dados, também se estabelece uma conexão muitos para muitos (many-to-many) entre <code class="docutils literal notranslate"><span class="pre">built_reports</span></code> e <code class="docutils literal notranslate"><span class="pre">object_storage</span></code>.</p>
<p><strong>❗OBS: Object Storage</strong>
Inicialmente não se havia acesso a um object storage real. Entretanto, com a transição para a AWS, o serviço de object storage (<code class="docutils literal notranslate"><span class="pre">S3</span></code>) pode ser implementado sem custo adicional no Lightsail.</p>
<p>O código foi desenvolvido com essa possiblidade em mente. Dessa forma, a transição para um object storage real deve ser direta.</p>
<div class="highlight-mermaid notranslate"><div class="highlight"><pre><span></span><span data-line="1">erDiagram
</span><span data-line="2">  BUILT_REPORTS ||--o{ STORAGE_RELATION : has
</span><span data-line="3">  OBJECT_STORAGE ||--o{ STORAGE_RELATION : contains
</span><span data-line="4">  CHAPTERS ||--o{ RELATIONS : maps
</span><span data-line="5">  REPORTS  ||--o{ RELATIONS : maps
</span><span data-line="6">
</span><span data-line="7">  BUILT_REPORTS {
</span><span data-line="8">    int id PK
</span><span data-line="9">    string title UK
</span><span data-line="10">    string description
</span><span data-line="11">    json  report_obj
</span><span data-line="12">    boolean completed
</span><span data-line="13">    timestamp datetime
</span><span data-line="14">  }
</span><span data-line="15">
</span><span data-line="16">  OBJECT_STORAGE {
</span><span data-line="17">    uuid id PK
</span><span data-line="18">    string filename UK
</span><span data-line="19">    string content_type
</span><span data-line="20">    bigint size_bytes
</span><span data-line="21">    bytes  data
</span><span data-line="22">    timestamp created_at
</span><span data-line="23">    timestamp updated_at
</span><span data-line="24">  }
</span><span data-line="25">
</span><span data-line="26">  STORAGE_RELATION {
</span><span data-line="27">    uuid   UUID PK  
</span><span data-line="28">    string report_title PK 
</span><span data-line="29">    string chapter_title PK
</span><span data-line="30">  }
</span><span data-line="31">
</span><span data-line="32">  CHAPTERS {
</span><span data-line="33">    int id PK
</span><span data-line="34">    string title UK
</span><span data-line="35">    text   prompt
</span><span data-line="36">    string description
</span><span data-line="37">  }
</span><span data-line="38">
</span><span data-line="39">  REPORTS {
</span><span data-line="40">    int id PK
</span><span data-line="41">    string title UK
</span><span data-line="42">    string description
</span><span data-line="43">  }
</span><span data-line="44">
</span><span data-line="45">  RELATIONS {
</span><span data-line="46">    string chapter_title PK 
</span><span data-line="47">    string report_title  PK 
</span><span data-line="48">    string position
</span><span data-line="49">  }
</span></pre></div>
</div>
<ul class="simple">
<li><p><strong>Tabelas</strong></p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">chapters</span></code> — Armazena o título, prompt e descrição dos capítulos criados</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">reports</span></code> — Armazena o título e descrição dos modelos criados</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">relations</span></code> — Relação muitos para muitos (many to many) entre os modelos e os capítulos, também contém a informação da ordem em que aquele capítulo aparece no modelo</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">built_reports</span></code> — Armazena os relatórios prontos, com as informações substituídas. Relatórios são armazenados em colunas <code class="docutils literal notranslate"><span class="pre">JSONB</span></code> do PostgreSQL.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">object_storage</span></code> — Simula um object storage para armazenar os arquivos enviados para elaboração do relatório.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">storage_relation</span></code> — Conexão muitos para muitos entre os relatórios construídos e os arquivos.</p></li>
</ul>
</li>
</ul>
</section>
<hr class="docutils" />
<section id="referencia-das-tabelas-modelos">
<h2>🔶 Referência das Tabelas / Modelos<a class="headerlink" href="#referencia-das-tabelas-modelos" title="Link to this heading">¶</a></h2>
<section id="chapters-app-models-chapters-chapter">
<h3>🔸<code class="docutils literal notranslate"><span class="pre">chapters</span></code> — <code class="docutils literal notranslate"><span class="pre">app.models.chapters.Chapter</span></code><a class="headerlink" href="#chapters-app-models-chapters-chapter" title="Link to this heading">¶</a></h3>
<div class="table-wrapper colwidths-auto docutils container">
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Campo</p></th>
<th class="head"><p>Tipo</p></th>
<th class="head"><p>Chave</p></th>
<th class="head"><p>Restrições / Notas</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">id</span></code></p></td>
<td><p>Integer</p></td>
<td><p>PK</p></td>
<td><p>Autoincremento</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">title</span></code></p></td>
<td><p>String(255)</p></td>
<td><p>UK</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">nullable=False</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">prompt</span></code></p></td>
<td><p>Text</p></td>
<td><p>—</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">nullable=False</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">description</span></code></p></td>
<td><p>String(255)</p></td>
<td><p>—</p></td>
<td><p>Opcional</p></td>
</tr>
</tbody>
</table>
</div>
<p><strong>Relacionamentos</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">relations:</span> <span class="pre">List[Relation]</span></code> — junção com <code class="docutils literal notranslate"><span class="pre">reports</span></code> (<code class="docutils literal notranslate"><span class="pre">back_populates=&quot;chapter&quot;</span></code>, <code class="docutils literal notranslate"><span class="pre">cascade=&quot;all,</span> <span class="pre">delete-orphan&quot;</span></code>).</p></li>
</ul>
<p><strong>Invariantes</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">title</span></code> único.</p></li>
<li><p>Remoção de um capítulo remove suas relações.</p></li>
</ul>
<p><strong>Exemplo</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="c1"># recuperar capítulos com suas posições em um report</span>
</span><span data-line="2"><span class="n">q</span> <span class="o">=</span> <span class="p">(</span>
</span><span data-line="3">    <span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Relation</span><span class="p">)</span>
</span><span data-line="4">    <span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Relation</span><span class="o">.</span><span class="n">report_title</span> <span class="o">==</span> <span class="s2">&quot;Relatório Técnico&quot;</span><span class="p">)</span>
</span><span data-line="5">    <span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="n">Relation</span><span class="o">.</span><span class="n">position</span><span class="o">.</span><span class="n">asc</span><span class="p">())</span>
</span><span data-line="6">    <span class="o">.</span><span class="n">all</span><span class="p">()</span>
</span><span data-line="7"><span class="p">)</span>
</span></pre></div>
</div>
</section>
<hr class="docutils" />
<section id="reports-app-models-reports-report">
<h3>🔸 <code class="docutils literal notranslate"><span class="pre">reports</span></code> — <code class="docutils literal notranslate"><span class="pre">app.models.reports.Report</span></code><a class="headerlink" href="#reports-app-models-reports-report" title="Link to this heading">¶</a></h3>
<div class="table-wrapper colwidths-auto docutils container">
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Campo</p></th>
<th class="head"><p>Tipo</p></th>
<th class="head"><p>Chave</p></th>
<th class="head"><p>Restrições / Notas</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">id</span></code></p></td>
<td><p>Integer</p></td>
<td><p>PK</p></td>
<td><p>Autoincremento</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">title</span></code></p></td>
<td><p>String(255)</p></td>
<td><p>UK</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">nullable=False</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">description</span></code></p></td>
<td><p>String(255)</p></td>
<td><p>—</p></td>
<td><p>Opcional</p></td>
</tr>
</tbody>
</table>
</div>
<p><strong>Relacionamentos</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">relations:</span> <span class="pre">List[Relation]</span></code> — junção com <code class="docutils literal notranslate"><span class="pre">chapters</span></code> (<code class="docutils literal notranslate"><span class="pre">back_populates=&quot;report&quot;</span></code>, <code class="docutils literal notranslate"><span class="pre">cascade=&quot;all,</span> <span class="pre">delete-orphan&quot;</span></code>).</p></li>
</ul>
<p><strong>Invariantes</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">title</span></code> único.</p></li>
</ul>
</section>
<hr class="docutils" />
<section id="relations-app-models-relations-relation">
<h3>🔸<code class="docutils literal notranslate"><span class="pre">relations</span></code> — <code class="docutils literal notranslate"><span class="pre">app.models.relations.Relation</span></code><a class="headerlink" href="#relations-app-models-relations-relation" title="Link to this heading">¶</a></h3>
<div class="table-wrapper colwidths-auto docutils container">
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Campo</p></th>
<th class="head"><p>Tipo</p></th>
<th class="head"><p>Chave</p></th>
<th class="head"><p>Restrições / Notas</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">chapter_title</span></code></p></td>
<td><p>String(255)</p></td>
<td><p>PK</p></td>
<td><p>FK → <code class="docutils literal notranslate"><span class="pre">chapters.title</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">report_title</span></code></p></td>
<td><p>String(255)</p></td>
<td><p>PK</p></td>
<td><p>FK → <code class="docutils literal notranslate"><span class="pre">reports.title</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">position</span></code></p></td>
<td><p>String</p></td>
<td><p>—</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">nullable=False</span></code> (avaliar migração para <code class="docutils literal notranslate"><span class="pre">Integer</span></code>)</p></td>
</tr>
</tbody>
</table>
</div>
<p><strong>Relacionamentos</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">chapter:</span> <span class="pre">Chapter</span></code> (<code class="docutils literal notranslate"><span class="pre">back_populates=&quot;relations&quot;</span></code>).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">report:</span> <span class="pre">Report</span></code> (<code class="docutils literal notranslate"><span class="pre">back_populates=&quot;relations&quot;</span></code>).</p></li>
</ul>
<p><strong>Notas</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">position</span></code> é <code class="docutils literal notranslate"><span class="pre">String</span></code>; caso a ordenação seja numérica, considerar migração para <code class="docutils literal notranslate"><span class="pre">Integer</span></code>.</p></li>
<li><p>Como as FKs são por <code class="docutils literal notranslate"><span class="pre">title</span></code>, renomeações de títulos exigem atualização transacional das junções.</p></li>
</ul>
</section>
<hr class="docutils" />
<section id="built-reports-app-models-built-reports-builtreports">
<h3>🔸 <code class="docutils literal notranslate"><span class="pre">built_reports</span></code> — <code class="docutils literal notranslate"><span class="pre">app.models.built_reports.BuiltReports</span></code><a class="headerlink" href="#built-reports-app-models-built-reports-builtreports" title="Link to this heading">¶</a></h3>
<div class="table-wrapper colwidths-auto docutils container">
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Campo</p></th>
<th class="head"><p>Tipo</p></th>
<th class="head"><p>Chave</p></th>
<th class="head"><p>Restrições / Notas</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">id</span></code></p></td>
<td><p>Integer</p></td>
<td><p>PK</p></td>
<td><p>Autoincremento</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">title</span></code></p></td>
<td><p>String</p></td>
<td><p>UK</p></td>
<td><p>—</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">description</span></code></p></td>
<td><p>String</p></td>
<td><p>—</p></td>
<td><p>Opcional</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">report_obj</span></code></p></td>
<td><p>JSONB (MutableDict)</p></td>
<td><p>—</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">default=dict</span></code>; alterações <em>in-place</em> são rastreadas</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">completed</span></code></p></td>
<td><p>Boolean</p></td>
<td><p>—</p></td>
<td><p>Opcional</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">datetime</span></code></p></td>
<td><p>DateTime(timezone=True)</p></td>
<td><p>—</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">server_default=func.now()</span></code>, <code class="docutils literal notranslate"><span class="pre">nullable=False</span></code></p></td>
</tr>
</tbody>
</table>
</div>
<p><strong>Índices</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">ix_built_reports_report_obj</span></code> (<code class="docutils literal notranslate"><span class="pre">report_obj</span></code>) com <code class="docutils literal notranslate"><span class="pre">postgresql_using=&quot;gin&quot;</span></code>.</p></li>
</ul>
<p><strong>Relacionamentos</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">storage_relation:</span> <span class="pre">List[StorageRelation]</span></code> — anexos por capítulo (<code class="docutils literal notranslate"><span class="pre">back_populates=&quot;built_report&quot;</span></code>, <code class="docutils literal notranslate"><span class="pre">cascade=&quot;all,</span> <span class="pre">delete-orphan&quot;</span></code>).</p></li>
</ul>
<p><strong>Notas</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">MutableDict</span></code> habilita rastreamento de alterações <em>in-place</em> no JSON.</p></li>
</ul>
<p><strong>Exemplos</strong></p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="c1">-- consulta por conteúdo JSONB (aproveita o índice GIN)</span>
</span><span data-line="2"><span class="k">SELECT</span>
</span><span data-line="3"><span class="n">ch</span><span class="w"> </span><span class="o">-&gt;&gt;</span><span class="w"> </span><span class="s1">&#39;title&#39;</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">title_field</span><span class="p">,</span>
</span><span data-line="4"><span class="n">ch</span><span class="w"> </span><span class="o">-&gt;&gt;</span><span class="w"> </span><span class="s1">&#39;text&#39;</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">text_field</span>
</span><span data-line="5"><span class="k">FROM</span>
</span><span data-line="6"><span class="n">built_reports</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">r</span>
</span><span data-line="7"><span class="k">CROSS</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="k">LATERAL</span>
</span><span data-line="8"><span class="n">jsonb_array_elements</span><span class="p">(</span><span class="n">r</span><span class="p">.</span><span class="n">report_obj</span><span class="o">-&gt;</span><span class="s1">&#39;chapters&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ch</span>
</span></pre></div>
</div>
</section>
<section id="object-storage-app-models-object-storage-objectstorage">
<h3>🔸 <code class="docutils literal notranslate"><span class="pre">object_storage</span></code> — <code class="docutils literal notranslate"><span class="pre">app.models.object_storage.ObjectStorage</span></code><a class="headerlink" href="#object-storage-app-models-object-storage-objectstorage" title="Link to this heading">¶</a></h3>
<p><strong>Papel</strong>: armazenamento de blobs com metadados.</p>
<p><strong>Campos</strong></p>
<div class="table-wrapper colwidths-auto docutils container">
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Campo</p></th>
<th class="head"><p>Tipo</p></th>
<th class="head"><p>Chave</p></th>
<th class="head"><p>Restrições / Notas</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">id</span></code></p></td>
<td><p>UUID (as_uuid=True)</p></td>
<td><p>PK</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">default=uuid.uuid4</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">filename</span></code></p></td>
<td><p>String</p></td>
<td><p>UK</p></td>
<td><p>—</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">content_type</span></code></p></td>
<td><p>String</p></td>
<td><p>—</p></td>
<td><p>MIME type</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">size_bytes</span></code></p></td>
<td><p>BigInteger</p></td>
<td><p>—</p></td>
<td><p>Tamanho em bytes</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">data</span></code></p></td>
<td><p>LargeBinary</p></td>
<td><p>—</p></td>
<td><p>Conteúdo binário</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">created_at</span></code></p></td>
<td><p>DateTime(timezone=True)</p></td>
<td><p>—</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">server_default=func.now()</span></code>, <code class="docutils literal notranslate"><span class="pre">nullable=False</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">updated_at</span></code></p></td>
<td><p>DateTime(timezone=True)</p></td>
<td><p>—</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">server_default=func.now()</span></code>, <code class="docutils literal notranslate"><span class="pre">onupdate=func.now()</span></code></p></td>
</tr>
</tbody>
</table>
</div>
<p><strong>Relacionamentos</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">storage_relation:</span> <span class="pre">List[StorageRelation]</span></code> (<code class="docutils literal notranslate"><span class="pre">back_populates=&quot;object_storage&quot;</span></code>, <code class="docutils literal notranslate"><span class="pre">cascade=&quot;all,</span> <span class="pre">delete-orphan&quot;</span></code>).</p></li>
</ul>
<p><strong>Exemplo</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="n">obj</span> <span class="o">=</span> <span class="n">ObjectStorage</span><span class="p">(</span>
</span><span data-line="2">    <span class="n">filename</span><span class="o">=</span><span class="s2">&quot;intro.odt&quot;</span><span class="p">,</span>
</span><span data-line="3">    <span class="n">content_type</span><span class="o">=</span><span class="s2">&quot;application/vnd.oasis.opendocument.text&quot;</span><span class="p">,</span>
</span><span data-line="4">    <span class="n">size_bytes</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">data_bytes</span><span class="p">),</span>
</span><span data-line="5">    <span class="n">data</span><span class="o">=</span><span class="n">data_bytes</span><span class="p">,</span>
</span><span data-line="6"><span class="p">)</span>
</span><span data-line="7"><span class="n">session</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">obj</span><span class="p">);</span> <span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
</span></pre></div>
</div>
</section>
<hr class="docutils" />
<section id="storage-relation-app-models-storage-relation-storagerelation">
<h3>🔸 <code class="docutils literal notranslate"><span class="pre">storage_relation</span></code> — <code class="docutils literal notranslate"><span class="pre">app.models.storage_relation.StorageRelation</span></code><a class="headerlink" href="#storage-relation-app-models-storage-relation-storagerelation" title="Link to this heading">¶</a></h3>
<div class="table-wrapper colwidths-auto docutils container">
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Campo</p></th>
<th class="head"><p>Tipo</p></th>
<th class="head"><p>Chave</p></th>
<th class="head"><p>Restrições / Notas</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">UUID</span></code></p></td>
<td><p>UUID</p></td>
<td><p>PK</p></td>
<td><p>FK → <code class="docutils literal notranslate"><span class="pre">object_storage.id</span></code>; <code class="docutils literal notranslate"><span class="pre">index=True</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">report_title</span></code></p></td>
<td><p>String(255)</p></td>
<td><p>PK</p></td>
<td><p>FK → <code class="docutils literal notranslate"><span class="pre">built_reports.title</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">chapter_title</span></code></p></td>
<td><p>String(255)</p></td>
<td><p>PK</p></td>
<td><p><strong>Sem FK explícita</strong> (recomenda-se adicionar FK)</p></td>
</tr>
</tbody>
</table>
</div>
<p><strong>Relacionamentos</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">built_report:</span> <span class="pre">BuiltReports</span></code> (<code class="docutils literal notranslate"><span class="pre">back_populates=&quot;storage_relation&quot;</span></code>).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">object_storage:</span> <span class="pre">ObjectStorage</span></code> (<code class="docutils literal notranslate"><span class="pre">back_populates=&quot;storage_relation&quot;</span></code>).</p></li>
</ul>
<p><strong>Exemplo</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="n">link</span> <span class="o">=</span> <span class="n">StorageRelation</span><span class="p">(</span>
</span><span data-line="2">    <span class="n">UUID</span><span class="o">=</span><span class="n">obj</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
</span><span data-line="3">    <span class="n">report_title</span><span class="o">=</span><span class="n">br</span><span class="o">.</span><span class="n">title</span><span class="p">,</span>
</span><span data-line="4">    <span class="n">chapter_title</span><span class="o">=</span><span class="s2">&quot;Introdução&quot;</span><span class="p">,</span>
</span><span data-line="5"><span class="p">)</span>
</span><span data-line="6"><span class="n">session</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">link</span><span class="p">);</span> <span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
</span></pre></div>
</div>
</section>
</section>
</section>

        </article><button class="back-to-top" type="button">
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
    <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
  </svg>
  <span>Back to top</span>
</button><div class="navigation flex print:hidden"><div class="navigation-prev">
    <a href="deploy.html">
      <i class="i-lucide chevron-left"></i>
      <div class="page-info">
        <span>Previous</span><div class="title">🔵 Deploy</div></div>
    </a>
  </div><div class="navigation-next">
    <a href="documentation.html">
      <div class="page-info">
        <span>Next</span>
        <div class="title">🔵 Guia da documentação</div>
      </div>
      <i class="i-lucide chevron-right"></i>
    </a>
  </div></div></div>
    </div>
  </main>
</div>
<footer class="sy-foot">
  <div class="sy-foot-inner sy-container mx-auto">
    <div class="sy-foot-reserved md:flex justify-between items-center">
      <div class="sy-foot-copyright"><p>2025, P&D-IA</p>
  
  <p>
    Made with
    
    <a href="https://www.sphinx-doc.org/">Sphinx</a> and
    
    <a href="https://shibuya.lepture.com">Shibuya theme</a>.
  </p>
</div>
      <div class="sy-foot-socials"></div>
    </div>
  </div>
</footer>
      <script src="../_static/documentation_options.js?v=5ffef437"></script>
      <script src="../_static/doctools.js?v=9bcbadda"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="../_static/shibuya.js?v=e730760c"></script></body>
</html>